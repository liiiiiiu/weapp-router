(function(s,h){typeof exports=="object"&&typeof module!="undefined"?module.exports=h():typeof define=="function"&&define.amd?define(h):(s=typeof globalThis!="undefined"?globalThis:s||self,s["weapp-router"]=h())})(this,function(){"use strict";class s{constructor(){this._pages=__wxConfig&&__wxConfig.pages||[],this._tabbars=__wxConfig&&__wxConfig.tabBar&&__wxConfig.tabBar.list&&__wxConfig.tabBar.list.length&&__wxConfig.tabBar.list.map(t=>t.pagePath)||[],this._routes={},this._route=null,s.TABBAR_TAG="@tabbar",s.RELAUNCH_TAG="@relaunch",this.pages2Routes()}firstUpper(t){return t=t+"",t.length>1?t[0].toUpperCase()+t.slice(1).toLowerCase():t.toUpperCase()}path2Camel(t){return t=t+"",t.replace(/([^_-])(?:[_-]+([^_-]))/g,(e,n,i)=>n+i.toUpperCase()).replace(/[_-]*/g,"")}path2Join(t){t[0]==="/"&&(t=t.substring(1));let e=t.split("/");return e.splice(e.length-1,1),e=e.map(n=>this.firstUpper(n)),e=e.map(n=>this.path2Camel(n)),e.join("")}getTag(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}nul(t){return t===null}plainObj(t){return typeof t=="object"&&!this.nul(t)&&this.getTag(t)==="[object Object]"}fun(t){return typeof t=="function"}num(t){return typeof t=="number"||typeof t=="object"&&!this.nul(t)&&this.getTag(t)==="[object Number]"}path2ConcatParam(t,e){if(!t||!e||!this.plainObj(e)||t.indexOf("?")>0||t.indexOf("&")>0||t.indexOf("=")>0)return t;let n=t+"?";return Object.keys(e).forEach((i,r,o)=>{n+=`${i}=${e[i]}${r!==o.length-1?"&":""}`}),n}path2Check(t){t=t+"";let e=t.indexOf(s.RELAUNCH_TAG)>-1;e&&(t=t.replace(s.RELAUNCH_TAG,""));let n=this._routes[t]||this._routes[t+s.TABBAR_TAG]||t,i=!!this._routes[t+s.TABBAR_TAG]||!!this._routes[this.path2Join(t)+s.TABBAR_TAG]||t.indexOf(s.TABBAR_TAG)>-1;return{newPath:n.replace(s.TABBAR_TAG,""),isTabbar:i,isRelaunch:e}}container4Callback(t,e,n){return{success:i=>{t&&this.fun(t)&&t(i)},fail:i=>{e&&this.fun(e)&&e(i)},complete:i=>{n&&this.fun(n)&&n(i)}}}log4Route(t,e){if(!t)return;const n=getCurrentPages(),i=n[n.length-1];this._route={from:i.route,to:typeof t=="number"?n[n.length-t<0?0:n.length-t].route:t,params:e}}pages2Routes(){let t=[];if(this._tabbars.length){let e=-1,n=this._tabbars.length;for(;++e<n;)t.push(this.path2Join(this._tabbars[e]))}if(this._pages.length){let e=0,n=this._pages.length;for(;e<n;e++){let i,r;i=r=this._pages[e],i=this.path2Join(i),Object.assign(this._routes,{[i]:"/"+r}),t.includes(i)&&Object.assign(this._routes,{[i+s.TABBAR_TAG]:"/"+r})}}else console.warn("[wx_router] Unable to get `pages` from app.json, url is needed!")}get routes(){const t={};return Object.keys(this._routes).forEach(e=>{e.indexOf(s.TABBAR_TAG)===-1&&(t[e]=this._routes[e])}),t}get route(){return this._route}push(t,e,n,i,r){if(!t)return;const{newPath:o,isTabbar:u}=this.path2Check(t);this.log4Route(o,e),(u?wx.switchTab:wx.navigateTo)({url:u?o:this.path2ConcatParam(o,e),...this.container4Callback(n,i,r)})}replace(t,e,n,i,r){if(!t)return;const{newPath:o,isTabbar:u,isRelaunch:f}=this.path2Check(t);this.log4Route(o,e),(f?wx.reLaunch:wx.redirectTo)({url:u?o:this.path2ConcatParam(o,e),...this.container4Callback(n,i,r)})}back(t,e,n,i){(!this.num(t)||t&&t<1)&&(t=1),this.log4Route(t||1,null),wx.navigateBack({delta:t,...this.container4Callback(e,n,i)})}}return new s});
